<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>PiText - Travel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="/travel/static/PiText_favicon.ico" />

  <!-- CSS Files -->
  <link rel="stylesheet" href="/travel/static/css/base.css" />
  <link rel="stylesheet" href="/travel/static/css/map.css" />
  <link rel="stylesheet" href="/travel/static/css/controls.css" />
  <link rel="stylesheet" href="/travel/static/css/panel.css" />
  <link rel="stylesheet" href="/travel/static/css/chat.css"/>
  <link rel="stylesheet" href="/travel/static/css/calendar.css"/>
</head>
<body>
  <!-- Full-Screen Map Container -->
  <div id="map">
    <!-- Initial "Ready" message -->
    <div class="loading">
      <p>üó∫Ô∏è Ready to plan your trip?</p>
      <p><small>Enter a city &amp; days, then click "Start Planning".</small></p>
    </div>
  </div>
  <!-- Voice-chat mic button -->
<button id="mic-btn" class="mic-btn" aria-label="Start voice chat">

  <!-- Sliding chat panel -->
  <aside id="chat-panel" class="chat-panel" aria-live="polite"></aside>

  <!-- simple SVG icon keeps it self-contained -->
  <svg viewBox="0 0 24 24" width="24" height="24">
    <path d="M12 2a4 4 0 0 1 4 4v6a4 4 0 1 1-8 0V6a4 4 0 0 1 4-4zM5 11h2a5 5 0 0 0 10 0h2a7 7 0 0 1-14 0zm7 9v-3h-2v3H8v2h8v-2h-4z"/>
  </svg>
</button>


  <!-- Transparent Outer Panel -->
  <div id="panel" class="hexagon-interface">
    <button id="minimize-btn" title="Minimize/Expand">‚àí</button>
    <!-- Inner Panel: blur  white background  rounding -->
    <div id="inner-panel">
    <div id="day-controls"></div>

      <form id="trip-form">
        <input id="city" type="text" placeholder="Enter city name" value="City" required />
        <input id="days" type="number" min="1" max="14" value="3" required />
        <button type="submit">Start Planning</button>
      </form>

      <!-- Calendar Integration -->
      <div class="calendar-panel">
        <div class="calendar-header">
          <h2>üìÖ Trip Calendar</h2>
          <button class="calendar-toggle" onclick="toggleCalendar()">Show Calendar</button>
        </div>
        <div class="calendar-content" id="calendar-content">
          <div id="calendar"></div>
        </div>
      </div>
    </div>
  </div>



  <!-- Loading / Error Overlay (injected by JS) -->
  <div id="map-overlay"></div>

  <!-- JavaScript Files - Load in dependency order -->
  <!-- Utilities first -->
  <script src="/travel/static/js/utils/constants.js"></script>
  <script src="/travel/static/js/utils/helpers.js"></script>
  
  <!-- API Layer -->
  <script src="/travel/static/js/api/config.js"></script>
  <script src="/travel/static/js/api/client.js"></script>
  
  <!-- UI Components -->
  <script src="/travel/static/js/ui/overlays.js"></script>
  <script src="/travel/static/js/ui/panel.js"></script>
  <script src="/travel/static/js/ui/form.js"></script>
  
<!-- Map components (must stay in this order) -->
<!-- Map components (must stay in this order) -->
<!-- Map components (must stay in this order) -->
<script src="/travel/static/js/map/google-maps.js"></script>

<!-- Dynamically load map modules after Google Maps is ready -->
<script>
window.mapModulesLoaded = false;
window.mapModulesReady = false;

window.loadMapModules = function() {
    if (window.mapModulesLoaded) return;
    
    // Ensure Google Maps is fully ready
    if (!window.google || !window.google.maps || !window.google.maps.marker) {
        console.log('Waiting for Google Maps to be fully ready...');
        setTimeout(window.loadMapModules, 100);
        return;
    }
    
    const scripts = [
        '/travel/static/js/map/markers.js',
        '/travel/static/js/map/routes.js', 
        '/travel/static/js/map/controls.js'
    ];
    
    let loadedCount = 0;
    
    function loadScript(src) {
        return new Promise((resolve, reject) => {
            const script = document.createElement('script');
            script.src = src;
            script.onload = resolve;
            script.onerror = reject;
            document.head.appendChild(script);
        });
    }
    
    // Load scripts sequentially to ensure proper order
    Promise.all(scripts.map(loadScript))
        .then(() => {
            window.mapModulesLoaded = true;
            window.mapModulesReady = true;
            console.log('All map modules loaded successfully');
            
            // Trigger any pending renders
            if (window.pendingRender) {
                window.TravelApp.renderTripOnMap(window.pendingRender);
                window.pendingRender = null;
            }
        })
        .catch(err => {
            console.error('Failed to load map modules:', err);
        });
};
</script>
<!-- Marker-clusterer library -->
<script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

<!-- FullCalendar Library -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<!-- Voice/chat helpers -->
<script src="/travel/static/js/voice.js"></script>
<script src="/travel/static/js/chat.js"></script>

<!-- Calendar Integration -->
<script src="/travel/static/js/calendar/index.js"></script>

<!-- Main app (calls renderTripOnMap) ‚Äì must be last, NO DEFER -->
<script src="/travel/static/js/app.js"></script>

<!-- Calendar Toggle Function -->
<script>
function toggleCalendar() {
    const content = document.getElementById('calendar-content');
    const toggle = document.querySelector('.calendar-toggle');
    
    if (content.classList.contains('active')) {
        content.classList.remove('active');
        toggle.textContent = 'Show Calendar';
    } else {
        content.classList.add('active');
        toggle.textContent = 'Hide Calendar';
        
        // Initialize calendar if not already done
        if (window.piTextCalendar && !window.piTextCalendar.initialized) {
            window.piTextCalendar.init();
        }
    }
}
</script>

</body>
</html>